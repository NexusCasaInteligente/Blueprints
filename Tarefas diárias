blueprint:
  name: Tarefas Diárias
  description: >
    Incrementa um contador diariamente no horário especificado. Quando atingir
    o número de dias configurado, ativa um input_boolean. Se o input_boolean
    for desligado manualmente, o contador volta a zero.

    Útil para acompanhar tarefas periódicas, como limpar a casa, regar plantas, 
    manutenção ou qualquer atividade recorrente.
  domain: automation
  input:
    boolean_alvo:
      name: Booleano da Tarefa
      description: Input_boolean que será ativado ao atingir o número de dias e que reseta o contador quando desligado.
      selector:
        entity:
          domain: input_boolean

    contador:
      name: Contador da Tarefa
      description: Contador que será incrementado diariamente.
      selector:
        entity:
          domain: counter

    dias_alvo:
      name: Dias até Acionar
      description: Número de dias para ativar o booleano.
      default: 7
      selector:
        number:
          min: 1
          max: 60
          unit_of_measurement: dias
          mode: slider

    hora_ativacao:
      name: Hora de Verificação Diária
      description: Horário diário para incrementar o contador e verificar.
      default: "00:00:00"
      selector:
        time: {}

mode: single

trigger:
  - platform: time
    at: !input hora_ativacao
    id: incrementar
  - platform: state
    entity_id: !input boolean_alvo
    to: 'off'
    id: zerar

condition: []

action:
  - choose:
      - conditions:
          - condition: trigger
            id: incrementar
        sequence:
          - service: counter.increment
            target:
              entity_id: !input contador

          - delay: '00:00:01'  # Garante tempo para atualização do estado

          - condition: numeric_state
            entity_id: !input contador
            above: '{{ (inputs.dias_alvo | int) - 1 }}'

          - service: input_boolean.turn_on
            target:
              entity_id: !input boolean_alvo

      - conditions:
          - condition: trigger
            id: zerar
        sequence:
          - service: counter.reset
            target:
              entity_id: !input contador
