blueprint:
  name: "Contador de Dias sem Tarefa (Usando Counter)"
  description: "Incrementa um counter diariamente e ativa um lembrete (booleano) após X dias. Zera ao desligar o lembrete."
  domain: automation
  input:
    contador:
      name: "Entidade do Counter"
      description: "Ex.: counter.dias_sem_varrer_a_casa"
      selector:
        entity:
          domain: counter
    booleano:
      name: "Entidade do Lembrete (input_boolean)"
      selector:
        entity:
          domain: input_boolean
    dias_para_lembrete:
      name: "Dias para ativar o lembrete"
      default: 7
      selector:
        number:
          min: 1
          max: 365
          step: 1

trigger:
  # Incrementa o counter diariamente à meia-noite
  - platform: time
    at: "00:00:00"
  # Monitora quando o booleano é desligado (para zerar o counter)
  - platform: state
    entity_id: !input booleano
    from: "on"
    to: "off"

action:
  # Se o gatilho for meia-noite: incrementa o counter
  - choose:
      - conditions:
          - condition: trigger
            id: "time"
        sequence:
          - service: counter.increment
            target:
              entity_id: !input contador
  # Se o gatilho for desligar o booleano: zera o counter
  - choose:
      - conditions:
          - condition: trigger
            id: "state"
        sequence:
          - service: counter.reset
            target:
              entity_id: !input contador
  # Se counter >= dias_para_lembrete, liga o booleano (e evita repetição)
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ states(('input_boolean.' + (input.booleano.split('.')[1])) == 'off' }}"
          - condition: template
            value_template: "{{ states(('counter.' + (input.contador.split('.')[1])) | int >= input.dias_para_lembrete }}"
        sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: !input booleano
