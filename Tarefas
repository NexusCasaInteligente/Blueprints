blueprint:
  name: "Contador de Dias sem Tarefa (Counter)"
  description: "Incrementa um counter diariamente e ativa um lembrete após X dias. Zera quando o lembrete é desligado."
  domain: automation
  input:
    contador:
      name: "Entidade do Counter"
      description: "Ex: counter.dias_sem_varrer_a_casa"
      selector:
        entity:
          domain: counter
    booleano:
      name: "Entidade do Lembrete"
      description: "Ex: input_boolean.varrer_a_casa"
      selector:
        entity:
          domain: input_boolean
    dias_para_lembrete:
      name: "Dias para ativar lembrete"
      default: 7
      selector:
        number:
          min: 1
          max: 365
          step: 1

trigger:
  # Incrementa diariamente
  - platform: time
    at: "00:00:00"
  # Detecta quando desliga o booleano
  - platform: state
    entity_id: !input booleano
    from: "on"
    to: "off"

action:
  # Ação 1: Incrementa counter diariamente
  - choose:
      - conditions:
          - condition: trigger
            id: "time"
        sequence:
          - service: counter.increment
            target:
              entity_id: !input contador

  # Ação 2: Reseta counter quando desliga booleano
  - choose:
      - conditions:
          - condition: trigger
            id: "state"
        sequence:
          - service: counter.reset
            target:
              entity_id: !input contador

  # Ação 3: Liga booleano quando atinge X dias
  - choose:
      - conditions:
          - condition: template
            value_template: "{{ states(input.booleano) == 'off' }}"
          - condition: template
            value_template: "{{ states(input.contador)|int >= input.dias_para_lembrete }}"
        sequence:
          - service: input_boolean.turn_on
            target:
              entity_id: !input booleano
